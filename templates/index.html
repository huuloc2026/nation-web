<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RFID Reader Control Panel</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="/static/style.css">
   
  </head>
  <body>
    <div class="main-layout">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
          <h3><i class="fas fa-rfid"></i> RFID Control</h3>
          <p>Ex10 Series Reader</p>
          <div class="connection-status">
            <span class="status-indicator" id="statusIndicator"></span>
            <span id="connectionStatus">Chưa kết nối</span>
          </div>
        </div>

        <div class="sidebar-content">
          <!-- Connection Section -->
          <div class="sidebar-section">
            <h5><i class="fas fa-plug"></i> Kết nối</h5>
            <div class="mb-3">
              <label for="portInput" class="form-label">Serial Port:</label>
              <input
                type="text"
                class="form-control"
                id="portInput"
                value="/dev/ttyUSB0"
                placeholder="Nhập serial port"
              />
            </div>
            <div class="mb-3">
              <label for="baudrateInput" class="form-label">Baudrate:</label>
              <select class="form-select" id="baudrateInput">
                <option value="9600">9600</option>
                <option value="19200">19200</option>
                <option value="38400">38400</option>
                <option value="57600" >57600</option>
                <option value="115200" selected>115200</option>
              </select>
            </div>
            <div class="d-grid gap-2">
              <button
                class="btn btn-success"
                id="connectBtn"
                onclick="connectReader()"
              >
                <span class="loading"
                  ><span class="spinner-border spinner-border-sm"></span
                ></span>
                <i class="fas fa-link"></i> Kết nối
              </button>
              <button
                class="btn btn-danger"
                id="disconnectBtn"
                onclick="disconnectReader()"
                disabled
              >
                <i class="fas fa-unlink"></i> Ngắt kết nối
              </button>
            </div>
          </div>

          <!-- Reader Info Section -->
          <div class="sidebar-section">
            <h5><i class="fas fa-info-circle"></i> Thông tin Reader</h5>
            <div id="readerInfo">
              <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.9em">
                Kết nối để xem thông tin reader
              </p>
            </div>
            <button
              class="btn btn-primary btn-sm"
              onclick="getReaderInfo()"
              id="infoBtn"
              disabled
            >
              <i class="fas fa-sync-alt"></i> Làm mới
            </button>
          </div>


          <!-- Antenna Control Section -->
<div class="sidebar-section">
  <h5><i class="fas fa-broadcast-tower"></i> Antenna Control</h5>
  <div class="mb-3">
    <label class="form-label">RF Power (dBm) cho từng antenna:</label>
    <div class="row g-2">
      <div class="col-6">
        <label for="powerInput1">Ant 1</label>
        <input type="number" class="form-control" id="powerInput1" min="0" max="30" value="20" />
      </div>
      <div class="col-6">
        <label for="powerInput2">Ant 2</label>
        <input type="number" class="form-control" id="powerInput2" min="0" max="30" value="20" />
      </div>
      <div class="col-6 mt-2">
        <label for="powerInput3">Ant 3</label>
        <input type="number" class="form-control" id="powerInput3" min="0" max="30" value="20" />
      </div>
      <div class="col-6 mt-2">
        <label for="powerInput4">Ant 4</label>
        <input type="number" class="form-control" id="powerInput4" min="0" max="30" value="20" />
      </div>
    </div>
    <div class="form-check mt-3">
      <input class="form-check-input" type="checkbox" id="preserveConfig" checked />
      <label class="form-check-label" for="preserveConfig" style="color: rgba(255, 255, 255, 0.8)">
        Lưu cấu hình khi tắt nguồn
      </label>
    </div>
  </div>
  <div class="d-grid gap-2 mb-2">
    <button class="btn btn-success" onclick="setPowerAllAntennas()" id="powerBtn">
      <i class="fas fa-bolt"></i> Set Power for All Antennas
    </button>
    <button class="btn btn-primary" onclick="getAntennaPower()" id="powerInfoBtn">
      <i class="fas fa-sync-alt"></i> Get Antenna Power
    </button>
  </div>

</div>

          <!-- Profile Section -->
          <div class="sidebar-section">
            <h5><i class="fas fa-cogs"></i> Profile</h5>
            <div class="mb-3">
              <label for="profileSelect" class="form-label">Profile:</label>
              <select class="form-select" id="profileSelect">
                <option value="11">11 - 640kHz, FM0, Tari 7.5μs</option>
                <option value="1">1 - 640kHz, Miller2, Tari 7.5μs</option>
                <option value="15">15 - 640kHz, Miller4, Tari 7.5μs</option>
                <option value="12">12 - 320kHz, Miller2, Tari 15μs</option>
                <option value="3">3 - 320kHz, Miller2, Tari 20μs</option>
                <option value="5">5 - 320kHz, Miller4, Tari 20μs</option>
                <option value="7">7 - 250kHz, Miller4, Tari 20μs</option>
                <option value="13">13 - 160kHz, Miller8, Tari 20μs</option>
              </select>
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="saveProfile"
                  checked
                />
                <label
                  class="form-check-label"
                  for="saveProfile"
                  style="color: rgba(255, 255, 255, 0.8)"
                >
                  Lưu khi tắt nguồn
                </label>
              </div>
            </div>
            <div class="d-grid gap-2">
              <button
                class="btn btn-primary"
                onclick="setProfile()"
                id="profileBtn"
                disabled
              >
                <i class="fas fa-save"></i> Thiết lập Profile
              </button>
              <button
                class="btn btn-info"
                onclick="getProfile()"
                id="getProfileBtn"
                disabled
              >
                <i class="fas fa-info"></i> Lấy Profile hiện tại
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Header -->
        <div class="main-header">
          <h2><i class="fas fa-tags"></i> Detected Tags</h2>
          <div class="stats-row">
            <div class="stat-item">
              <div class="stat-number" id="uniqueTags">0</div>
              <div class="stat-label">Tag</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="totalTags">0</div>
              <div class="stat-label">Total Tag</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="timer">00:00:00</div>
              <div class="stat-label">Timer</div>
            </div>
          </div>
        </div>

        <!-- Control Buttons -->
        <div class="control-buttons">
          <button
            class="btn btn-primary"
            onclick="startInventory(0)"
            id="startTargetABtn"
            disabled
          >
            <i class="fas fa-play"></i> Start Inventory (Target A)
          </button>
          <button
            class="btn btn-success"
            onclick="openTagsInventoryModal()"
            id="tagsInventoryBtn"
            disabled
          >
            <i class="fas fa-cogs"></i> Tags Inventory
          </button>
          <button
            class="btn btn-warning"
            onclick="stopInventory()"
            id="stopBtn"
            disabled
          >
            <i class="fas fa-stop"></i> Stop Inventory
          </button>
          <button class="btn btn-danger" onclick="clearTags()">
            <i class="fas fa-trash"></i> Clear Tags
          </button>
          <button class="btn btn-secondary" onclick="resetReader()">
            <i class="fas fa-redo"></i> Reset Reader
          </button>
        </div>

        <!-- Tags Table -->
        <div class="tags-card">
          <div class="tags-header">
            <h4><i class="fas fa-table"></i> Tags Table</h4>
          </div>
          <div class="table-responsive">
            <table class="table table-hover" id="tagsTable">
              <thead>
                <tr>
                  <th>EPC</th>
                  <th>Count</th>
                  <th>Antenna</th>
                  <th>RSSI (dBm)</th>
                  <th>Last Seen</th>
                </tr>
              </thead>
              <tbody id="tagsTableBody">
                <tr>
                  <td colspan="5" class="text-center text-muted">
                    Chưa có tags được phát hiện
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tags Inventory Modal -->
        <div
          class="modal fade"
          id="tagsInventoryModal"
          tabindex="-1"
          aria-labelledby="tagsInventoryModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="tagsInventoryModalLabel">
                  Tags Inventory Settings
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="qValueInput" class="form-label"
                    >Q-value (0-15):</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="qValueInput"
                    min="0"
                    max="15"
                    value="4"
                  />
                </div>
                <div class="mb-3">
                  <label for="sessionInput" class="form-label"
                    >Session (0-3):</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="sessionInput"
                    min="0"
                    max="3"
                    value="0"
                  />
                </div>
                <div class="mb-3">
                  <label for="scanTimeInput" class="form-label"
                    >Scan Time (100ms units, 1-255):</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="scanTimeInput"
                    min="1"
                    max="255"
                    value="10"
                  />
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Đóng
                </button>
                <button
                  type="button"
                  class="btn btn-danger"
                  onclick="stopTagsInventory()"
                >
                  Dừng đọc
                </button>
                <button
                  type="button"
                  class="btn btn-success"
                  onclick="startTagsInventory()"
                >
                  Bắt đầu đọc
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Alerts -->
    <div
      id="alertContainer"
      style="
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 400px;
      "
    ></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
    <script src="/static/script.js"></script>
  </body>
</html>
